//
// Dust - Asynchronous Templating v0.3.0amd
// http://akdubya.github.com/dustjs
//
// Copyright (c) 2010, Aleksander Williams
// Released under the MIT License.
//
// Modifications by Jeff Barczewski, 2012
//

define("dust",[],function(){function Context(a,b,c){this.stack=a,this.global=b,this.blocks=c}function Stack(a,b,c,d){this.tail=b,this.isObject=!dust.isArray(a)&&a&&typeof a=="object",this.head=a,this.index=c,this.of=d}function Stub(a){this.head=new Chunk(this),this.callback=a,this.out=""}function Stream(){this.head=new Chunk(this)}function Chunk(a,b,c){this.root=a,this.next=b,this.data="",this.flushable=!1,this.taps=c}function Tap(a,b){this.head=a,this.tail=b}var dust={};dust.cache={},dust.register=function(a,b){if(!a)return;dust.cache[a]=b},dust.render=function(a,b,c){var d=(new Stub(c)).head;dust.load(a,d,Context.wrap(b)).end()},dust.stream=function(a,b){var c=new Stream;return dust.nextTick(function(){dust.load(a,c.head,Context.wrap(b)).end()}),c},dust.renderSource=function(a,b,c){return dust.compileFn(a)(b,c)},dust.compileFn=function(a,b){var c=dust.loadSource(dust.compile(a,b));return function(a,b){var d=b?new Stub(b):new Stream;return dust.nextTick(function(){c(d.head,Context.wrap(a)).end()}),d}},dust.load=function(a,b,c){var d=dust.cache[a];return d?d(b,c):dust.onLoad?b.map(function(b){dust.onLoad(a,function(d,e){if(d)return b.setError(d);dust.cache[a]||dust.loadSource(dust.compile(e,a)),dust.cache[a](b,c).end()})}):b.setError(new Error("Template Not Found: "+a))},dust.loadSource=function(source,path){return eval(source)},Array.isArray?dust.isArray=Array.isArray:dust.isArray=function(a){return Object.prototype.toString.call(a)=="[object Array]"},dust.nextTick=function(a){setTimeout(a,0)},dust.isEmpty=function(a){return dust.isArray(a)&&!a.length?!0:a===0?!1:!a},dust.filter=function(a,b,c){if(c)for(var d=0,e=c.length;d<e;d++){var f=c[d];f==="s"?b=null:a=dust.filters[f](a)}return b&&(a=dust.filters[b](a)),a},dust.filters={h:function(a){return dust.escapeHtml(a)},j:function(a){return dust.escapeJs(a)},u:encodeURI,uc:encodeURIComponent},dust.makeBase=function(a){return new Context(new Stack,a)},Context.wrap=function(a){return a instanceof Context?a:new Context(new Stack(a))},Context.prototype.get=function(a){var b=this.stack,c;while(b){if(b.isObject){c=b.head[a];if(c!==undefined)return c}b=b.tail}return this.global?this.global[a]:undefined},Context.prototype.getPath=function(a,b){var c=this.stack,d=b.length;if(a&&d===0)return c.head;if(!c.isObject)return undefined;c=c.head;var e=0;while(c&&e<d)c=c[b[e]],e++;return c},Context.prototype.push=function(a,b,c){return new Context(new Stack(a,this.stack,b,c),this.global,this.blocks)},Context.prototype.rebase=function(a){return new Context(new Stack(a),this.global,this.blocks)},Context.prototype.current=function(){return this.stack.head},Context.prototype.getBlock=function(a){var b=this.blocks;if(!b)return;var c=b.length,d;while(c--){d=b[c][a];if(d)return d}},Context.prototype.shiftBlocks=function(a){var b=this.blocks;return a?(b?newBlocks=b.concat([a]):newBlocks=[a],new Context(this.stack,this.global,newBlocks)):this},Stub.prototype.flush=function(){var a=this.head;while(a){if(a.flushable)this.out+=a.data;else{if(a.error){this.callback(a.error),this.flush=function(){};return}return}a=a.next,this.head=a}this.callback(null,this.out)},Stream.prototype.flush=function(){var a=this.head;while(a){if(a.flushable)this.emit("data",a.data);else{if(a.error){this.emit("error",a.error),this.flush=function(){};return}return}a=a.next,this.head=a}this.emit("end")},Stream.prototype.emit=function(a,b){var c=this.events;c&&c[a]&&c[a](b)},Stream.prototype.on=function(a,b){return this.events||(this.events={}),this.events[a]=b,this},Chunk.prototype.write=function(a){var b=this.taps;return b&&(a=b.go(a)),this.data+=a,this},Chunk.prototype.end=function(a){return a&&this.write(a),this.flushable=!0,this.root.flush(),this},Chunk.prototype.map=function(a){var b=new Chunk(this.root,this.next,this.taps),c=new Chunk(this.root,b,this.taps);return this.next=c,this.flushable=!0,a(c),b},Chunk.prototype.tap=function(a){var b=this.taps;return b?this.taps=b.push(a):this.taps=new Tap(a),this},Chunk.prototype.untap=function(){return this.taps=this.taps.tail,this},Chunk.prototype.render=function(a,b){return a(this,b)},Chunk.prototype.reference=function(a,b,c,d){if(typeof a=="function"){a=a(this,b,null,{auto:c,filters:d});if(a instanceof Chunk)return a}return dust.isEmpty(a)?this:this.write(dust.filter(a,c,d))},Chunk.prototype.section=function(a,b,c,d){if(typeof a=="function"){a=a(this,b,c,d);if(a instanceof Chunk)return a}var e=c.block,f=c["else"];d&&(b=b.push(d));if(dust.isArray(a)){if(e){var g=a.length,h=this;for(var i=0;i<g;i++)h=e(h,b.push(a[i],i,g));return h}}else if(a===!0){if(e)return e(this,b)}else if(a||a===0){if(e)return e(this,b.push(a))}else if(f)return f(this,b);return this},Chunk.prototype.exists=function(a,b,c){var d=c.block,e=c["else"];if(!dust.isEmpty(a)){if(d)return d(this,b)}else if(e)return e(this,b);return this},Chunk.prototype.notexists=function(a,b,c){var d=c.block,e=c["else"];if(dust.isEmpty(a)){if(d)return d(this,b)}else if(e)return e(this,b);return this},Chunk.prototype.block=function(a,b,c){var d=c.block;return a&&(d=a),d?d(this,b):this},Chunk.prototype.partial=function(a,b){return typeof a=="function"?this.capture(a,b,function(a,c){dust.load(a,c,b).end()}):dust.load(a,this,b)},Chunk.prototype.helper=function(a,b,c,d){return dust.helpers[a](this,b,c,d)},Chunk.prototype.capture=function(a,b,c){return this.map(function(d){var e=new Stub(function(a,b){a?d.setError(a):c(b,d)});a(e.head,b).end()})},Chunk.prototype.setError=function(a){return this.error=a,this.root.flush(),this},dust.helpers={sep:function(a,b,c){return b.stack.index===b.stack.of-1?a:c.block(a,b)},idx:function(a,b,c){return c.block(a,b.push(b.stack.index))}},Tap.prototype.push=function(a){return new Tap(a,this)},Tap.prototype.go=function(a){var b=this;while(b)a=b.head(a),b=b.tail;return a};var HCHARS=new RegExp(/[&<>\"]/),AMP=/&/g,LT=/</g,GT=/>/g,QUOT=/\"/g;dust.escapeHtml=function(a){return typeof a=="string"?HCHARS.test(a)?a.replace(AMP,"&amp;").replace(LT,"&lt;").replace(GT,"&gt;").replace(QUOT,"&quot;"):a:a};var BS=/\\/g,CR=/\r/g,LS=/\u2028/g,PS=/\u2029/g,NL=/\n/g,LF=/\f/g,SQ=/'/g,DQ=/"/g,TB=/\t/g;return dust.escapeJs=function(a){return typeof a=="string"?a.replace(BS,"\\\\").replace(DQ,'\\"').replace(SQ,"\\'").replace(CR,"\\r").replace(LS,"\\u2028").replace(PS,"\\u2029").replace(NL,"\\n").replace(LF,"\\f").replace(TB,"\\t"):a},dust}),define("compiler",["./dust"],function(a){function b(b){var c={};return a.filterNode(c,b)}function c(b,c){var d=[c[0]];for(var e=1,f=c.length;e<f;e++){var g=a.filterNode(b,c[e]);g&&d.push(g)}return d}function d(b,c){var d=[c[0]],e;for(var f=1,g=c.length;f<g;f++){var h=a.filterNode(b,c[f]);h&&(h[0]==="buffer"?e?e[1]+=h[1]:(e=h,d.push(h)):(e=null,d.push(h)))}return d}function f(a,b){return["buffer",e[b[1]]]}function g(a,b){return b}function h(){}function i(b,c){var d={name:c,bodies:[],blocks:{},index:0,auto:"h"};return"(function(){dust.register("+(c?'"'+c+'"':"null")+","+a.compileNode(d,b)+");"+j(d)+k(d)+"return body_0;"+"})();"}function j(a){var b=[],c=a.blocks;for(var d in c)b.push(d+":"+c[d]);return b.length?(a.blocks="ctx=ctx.shiftBlocks(blocks);","var blocks={"+b.join(",")+"};"):a.blocks=""}function k(a){var b=[],c=a.bodies,d=a.blocks;for(var e=0,f=c.length;e<f;e++)b[e]="function body_"+e+"(chk,ctx){"+d+"return chk"+c[e]+";}";return b.join("")}function l(b,c){var d="";for(var e=1,f=c.length;e<f;e++)d+=a.compileNode(b,c[e]);return d}function m(b,c,d){return"."+d+"("+a.compileNode(b,c[1])+","+a.compileNode(b,c[2])+","+a.compileNode(b,c[4])+","+a.compileNode(b,c[3])+")"}a.compile=function(c,d){var e=b(a.parse(c));return i(e,d)},a.filterNode=function(b,c){return a.optimizers[c[0]](b,c)},a.optimizers={body:d,buffer:g,special:f,format:h,reference:c,"#":c,"?":c,"^":c,"<":c,"+":c,"@":c,"%":c,partial:c,context:c,params:c,bodies:c,param:c,filters:g,key:g,path:g,literal:g,comment:h},a.pragmas={esc:function(a,b,c,d){var e=a.auto;b||(b="h"),a.auto=b==="s"?"":b;var f=l(a,c.block);return a.auto=e,f}};var e={s:" ",n:"\n",r:"\r",lb:"{",rb:"}"};a.compileNode=function(b,c){return a.nodes[c[0]](b,c)},a.nodes={body:function(a,b){var c=a.index++,d="body_"+c;return a.bodies[c]=l(a,b),d},buffer:function(a,b){return".write("+n(b[1])+")"},format:function(a,b){return".write("+n(b[1]+b[2])+")"},reference:function(b,c){return".reference("+a.compileNode(b,c[1])+",ctx,"+a.compileNode(b,c[2])+")"},"#":function(a,b){return m(a,b,"section")},"?":function(a,b){return m(a,b,"exists")},"^":function(a,b){return m(a,b,"notexists")},"<":function(b,c){var d=c[4];for(var e=1,f=d.length;e<f;e++){var g=d[e],h=g[1][1];if(h==="block")return b.blocks[c[1].text]=a.compileNode(b,g[2]),""}return""},"+":function(b,c){return".block(ctx.getBlock("+n(c[1].text)+"),"+a.compileNode(b,c[2])+","+a.compileNode(b,c[4])+","+a.compileNode(b,c[3])+")"},"@":function(b,c){return".helper("+n(c[1].text)+","+a.compileNode(b,c[2])+","+a.compileNode(b,c[4])+","+a.compileNode(b,c[3])+")"},"%":function(b,c){var d=c[1][1];if(!a.pragmas[d])return"";var e=c[4],f={};for(var g=1,h=e.length;g<h;g++){var i=e[g];f[i[1][1]]=i[2]}var j=c[3],k={};for(var g=1,h=j.length;g<h;g++){var l=j[g];k[l[1][1]]=l[2][1]}var m=c[2][1]?c[2][1].text:null;return a.pragmas[d](b,m,f,k)},partial:function(b,c){return".partial("+a.compileNode(b,c[1])+","+a.compileNode(b,c[2])+")"},context:function(b,c){return c[1]?"ctx.rebase("+a.compileNode(b,c[1])+")":"ctx"},params:function(b,c){var d=[];for(var e=1,f=c.length;e<f;e++)d.push(a.compileNode(b,c[e]));return d.length?"{"+d.join(",")+"}":"null"},bodies:function(b,c){var d=[];for(var e=1,f=c.length;e<f;e++)d.push(a.compileNode(b,c[e]));return"{"+d.join(",")+"}"},param:function(b,c){return a.compileNode(b,c[1])+":"+a.compileNode(b,c[2])},filters:function(a,b){var c=[];for(var d=1,e=b.length;d<e;d++){var f=b[d];c.push('"'+f+'"')}return'"'+a.auto+'"'+(c.length?",["+c.join(",")+"]":"")},key:function(a,b){return'ctx.get("'+b[1]+'")'},path:function(a,b){var c=b[1],d=b[2],e=[];for(var f=0,g=d.length;f<g;f++)e.push('"'+d[f]+'"');return"ctx.getPath("+c+",["+e.join(",")+"])"},literal:function(a,b){return n(b[1])}};var n=typeof JSON=="undefined"?function(b){return'"'+a.escapeJs(b)+'"'}:JSON.stringify;return a}),define("parser",["./dust"],function(a){var b=function(){var a={parse:function(a,b){function i(a,b,c){var d=a,e=c-a.length;for(var f=0;f<e;f++)d=b+d;return d}function j(a){var b=a.charCodeAt(0);if(b<=255)var c="x",d=2;else var c="u",d=4;return"\\"+c+i(b.toString(16).toUpperCase(),"0",d)}function k(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/[\x80-\uFFFF]/g,j)+'"'}function l(a){if(d<f)return;d>f&&(f=d,g=[]),g.push(a)}function m(){var a="body@"+d,b=h[a];if(b)return d=b.nextPos,b.result;var c=[],e=n();while(e!==null){c.push(e);var e=n()}var f=c!==null?function(a){return["body"].concat(a)}(c):null;return h[a]={nextPos:d,result:f},f}function n(){var a="part@"+d,b=h[a];if(b)return d=b.nextPos,b.result;var c=G();if(c!==null)var e=c;else{var f=o();if(f!==null)var e=f;else{var g=v();if(g!==null)var e=g;else{var i=x();if(i!==null)var e=i;else{var j=u();if(j!==null)var e=j;else{var k=D();if(k!==null)var e=k;else var e=null}}}}}return h[a]={nextPos:d,result:e},e}function o(){var b="section@"+d,c=h[b];if(c)return d=c.nextPos,c.result;var f=e;e=!1;var g=d,i=p();if(i!==null){var j=J();if(j!==null){var k=m();if(k!==null){var n=t();if(n!==null){var o=q();if(o!==null){var r=function(){return i[1].text===o.text}()?"":null;if(r!==null)var s=[i,j,k,n,o,r];else{var s=null;d=g}}else{var s=null;d=g}}else{var s=null;d=g}}else{var s=null;d=g}}else{var s=null;d=g}}else{var s=null;d=g}var u=s!==null?function(a,b,c,d){return c.push(["param",["literal","block"],b]),a.push(c),a}(s[0],s[2],s[3],s[4]):null;if(u!==null)var v=u;else{var w=d,x=p();if(x!==null){if(a.substr(d,1)==="/"){var y="/";d+=1}else{var y=null;e&&l('"/"')}if(y!==null){var z=J();if(z!==null)var A=[x,y,z];else{var A=null;d=w}}else{var A=null;d=w}}else{var A=null;d=w}var B=A!==null?function(a){return a.push(["bodies"]),a}(A[0]):null;if(B!==null)var v=B;else var v=null}return e=f,e&&v===null&&l("section"),h[b]={nextPos:d,result:v},v}function p(){var b="sec_tag_start@"+d,c=h[b];if(c)return d=c.nextPos,c.result;var f=d,g=I();if(g!==null){if(a.substr(d).match(/^[#?^<+@%]/)!==null){var i=a.charAt(d);d++}else{var i=null;e&&l("[#?^<+@%]")}if(i!==null){var j=y();if(j!==null){var k=r();if(k!==null){var m=s();if(m!==null)var n=[g,i,j,k,m];else{var n=null;d=f}}else{var n=null;d=f}}else{var n=null;d=f}}else{var n=null;d=f}}else{var n=null;d=f}var o=n!==null?function(a,b,c,d){return[a,b,c,d]}(n[1],n[2],n[3],n[4]):null;return h[b]={nextPos:d,result:o},o}function q(){var b="end_tag@"+d,c=h[b];if(c)return d=c.nextPos,c.result;var f=e;e=!1;var g=d,i=I();if(i!==null){if(a.substr(d,1)==="/"){var j="/";d+=1}else{var j=null;e&&l('"/"')}if(j!==null){var k=y();if(k!==null){var m=J();if(m!==null)var n=[i,j,k,m];else{var n=null;d=g}}else{var n=null;d=g}}else{var n=null;d=g}}else{var n=null;d=g}var o=n!==null?function(a){return a}(n[2]):null;return e=f,e&&o===null&&l("end tag"),h[b]={nextPos:d,result:o},o}function r(){var b="context@"+d,c=h[b];if(c)return d=c.nextPos,c.result;var f=d;if(a.substr(d,1)===":"){var g=":";d+=1}else{var g=null;e&&l('":"')}if(g!==null){var i=y();if(i!==null)var j=[g,i];else{var j=null;d=f}}else{var j=null;d=f}var k=j!==null?function(a){return a}(j[1]):null,m=k!==null?k:"",n=m!==null?function(a){return a?["context",a]:["context"]}(m):null;return h[b]={nextPos:d,result:n},n}function s(){var b="params@"+d,c=h[b];if(c)return d=c.nextPos,c.result;var f=e;e=!1;var g=[],i=d,j=L();if(j!==null){var k=A();if(k!==null){if(a.substr(d,1)==="="){var m="=";d+=1}else{var m=null;e&&l('"="')}if(m!==null){var n=y();if(n!==null)var o=n;else{var p=B();if(p!==null)var o=p;else var o=null}if(o!==null)var q=[j,k,m,o];else{var q=null;d=i}}else{var q=null;d=i}}else{var q=null;d=i}}else{var q=null;d=i}var r=q!==null?function(a,b){return["param",["literal",a],b]}(q[1],q[3]):null;while(r!==null){g.push(r);var i=d,j=L();if(j!==null){var k=A();if(k!==null){if(a.substr(d,1)==="="){var m="=";d+=1}else{var m=null;e&&l('"="')}if(m!==null){var n=y();if(n!==null)var o=n;else{var p=B();if(p!==null)var o=p;else var o=null}if(o!==null)var q=[j,k,m,o];else{var q=null;d=i}}else{var q=null;d=i}}else{var q=null;d=i}}else{var q=null;d=i}var r=q!==null?function(a,b){return["param",["literal",a],b]}(q[1],q[3]):null}var s=g!==null?function(a){return["params"].concat(a)}(g):null;return e=f,e&&s===null&&l("params"),h[b]={nextPos:d,result:s},s}function t(){var b="bodies@"+d,c=h[b];if(c)return d=c.nextPos,c.result;var f=e;e=!1;var g=[],i=d,j=I();if(j!==null){if(a.substr(d,1)===":"){var k=":";d+=1}else{var k=null;e&&l('":"')}if(k!==null){var n=A();if(n!==null){var o=J();if(o!==null){var p=m();if(p!==null)var q=[j,k,n,o,p];else{var q=null;d=i}}else{var q=null;d=i}}else{var q=null;d=i}}else{var q=null;d=i}}else{var q=null;d=i}var r=q!==null?function(a,b){return["param",["literal",a],b]}(q[2],q[4]):null;while(r!==null){g.push(r);var i=d,j=I();if(j!==null){if(a.substr(d,1)===":"){var k=":";d+=1}else{var k=null;e&&l('":"')}if(k!==null){var n=A();if(n!==null){var o=J();if(o!==null){var p=m();if(p!==null)var q=[j,k,n,o,p];else{var q=null;d=i}}else{var q=null;d=i}}else{var q=null;d=i}}else{var q=null;d=i}}else{var q=null;d=i}var r=q!==null?function(a,b){return["param",["literal",a],b]}(q[2],q[4]):null}var s=g!==null?function(a){return["bodies"].concat(a)}(g):null;return e=f,e&&s===null&&l("bodies"),h[b]={nextPos:d,result:s},s}function u(){var a="reference@"+d,b=h[a];if(b)return d=b.nextPos,b.result;var c=e;e=!1;var f=d,g=I();if(g!==null){var i=y();if(i!==null){var j=w();if(j!==null){var k=J();if(k!==null)var m=[g,i,j,k];else{var m=null;d=f}}else{var m=null;d=f}}else{var m=null;d=f}}else{var m=null;d=f}var n=m!==null?function(a,b){return["reference",a,b]}(m[1],m[2]):null;return e=c,e&&n===null&&l("reference"),h[a]={nextPos:d,result:n},n}function v(){var b="partial@"+d,c=h[b];if(c)return d=c.nextPos,c.result;var f=e;e=!1;var g=d,i=I();if(i!==null){if(a.substr(d,1)===">"){var j=">";d+=1}else{var j=null;e&&l('">"')}if(j!==null){var k=A(),m=k!==null?function(a){return["literal",a]}(k):null;if(m!==null)var n=m;else{var o=B();if(o!==null)var n=o;else var n=null}if(n!==null){var p=r();if(p!==null){if(a.substr(d,1)==="/"){var q="/";d+=1}else{var q=null;e&&l('"/"')}if(q!==null){var s=J();if(s!==null)var t=[i,j,n,p,q,s];else{var t=null;d=g}}else{var t=null;d=g}}else{var t=null;d=g}}else{var t=null;d=g}}else{var t=null;d=g}}else{var t=null;d=g}var u=t!==null?function(a,b){return["partial",a,b]}(t[2],t[3]):null;return e=f,e&&u===null&&l("partial"),h[b]={nextPos:d,result:u},u}function w(){var b="filters@"+d,c=h[b];if(c)return d=c.nextPos,c.result;var f=e;e=!1;var g=[],i=d;if(a.substr(d,1)==="|"){var j="|";d+=1}else{var j=null;e&&l('"|"')}if(j!==null){var k=A();if(k!==null)var m=[j,k];else{var m=null;d=i}}else{var m=null;d=i}var n=m!==null?function(a){return a}(m[1]):null;while(n!==null){g.push(n);var i=d;if(a.substr(d,1)==="|"){var j="|";d+=1}else{var j=null;e&&l('"|"')}if(j!==null){var k=A();if(k!==null)var m=[j,k];else{var m=null;d=i}}else{var m=null;d=i}var n=m!==null?function(a){return a}(m[1]):null}var o=g!==null?function(a){return["filters"].concat(a)}(g):null;return e=f,e&&o===null&&l("filters"),h[b]={nextPos:d,result:o},o}function x(){var b="special@"+d,c=h[b];if(c)return d=c.nextPos,c.result;var f=e;e=!1;var g=d,i=I();if(i!==null){if(a.substr(d,1)==="~"){var j="~";d+=1}else{var j=null;e&&l('"~"')}if(j!==null){var k=A();if(k!==null){var m=J();if(m!==null)var n=[i,j,k,m];else{var n=null;d=g}}else{var n=null;d=g}}else{var n=null;d=g}}else{var n=null;d=g}var o=n!==null?function(a){return["special",a]}(n[2]):null;return e=f,e&&o===null&&l("special"),h[b]={nextPos:d,result:o},o}function y(){var a="identifier@"+d,b=h[a];if(b)return d=b.nextPos,b.result;var c=e;e=!1;var f=z(),g=f!==null?function(b){return O(["path"].concat(b),a)}(f):null;if(g!==null)var i=g;else{var j=A(),k=j!==null?function(b){return O(["key",b],a)}(j):null;if(k!==null)var i=k;else var i=null}return e=c,e&&i===null&&l("identifier"),h[a]={nextPos:d,result:i},i}function z(){var b="path@"+d,c=h[b];if(c)return d=c.nextPos,c.result;var f=e;e=!1;var g=d,i=A(),j=i!==null?i:"";if(j!==null){var k=d;if(a.substr(d,1)==="."){var m=".";d+=1}else{var m=null;e&&l('"."')}if(m!==null){var n=A();if(n!==null)var o=[m,n];else{var o=null;d=k}}else{var o=null;d=k}var p=o!==null?function(a){return a}(o[1]):null;if(p!==null){var q=[];while(p!==null){q.push(p);var k=d;if(a.substr(d,1)==="."){var m=".";d+=1}else{var m=null;e&&l('"."')}if(m!==null){var n=A();if(n!==null)var o=[m,n];else{var o=null;d=k}}else{var o=null;d=k}var p=o!==null?function(a){return a}(o[1]):null}}else var q=null;if(q!==null)var r=[j,q];else{var r=null;d=g}}else{var r=null;d=g}var s=r!==null?function(a,b){return a?(b.unshift(a),[!1,b]):[!0,b]}(r[0],r[1]):null;if(s!==null)var t=s;else{if(a.substr(d,1)==="."){var u=".";d+=1}else{var u=null;e&&l('"."')}var v=u!==null?function(){return[!0,[]]}():null;if(v!==null)var t=v;else var t=null}return e=f,e&&t===null&&l("path"),h[b]={nextPos:d,result:t},t}function A(){var b="key@"+d,c=h[b];if(c)return d=c.nextPos,c.result;var f=e;e=!1;var g=d;if(a.substr(d).match(/^[a-zA-Z_$]/)!==null){var i=a.charAt(d);d++}else{var i=null;e&&l("[a-zA-Z_$]")}if(i!==null){var j=[];if(a.substr(d).match(/^[0-9a-zA-Z_$]/)!==null){var k=a.charAt(d);d++}else{var k=null;e&&l("[0-9a-zA-Z_$]")}while(k!==null){j.push(k);if(a.substr(d).match(/^[0-9a-zA-Z_$]/)!==null){var k=a.charAt(d);d++}else{var k=null;e&&l("[0-9a-zA-Z_$]")}}if(j!==null)var m=[i,j];else{var m=null;d=g}}else{var m=null;d=g}var n=m!==null?function(a,b){return a+b.join("")}(m[0],m[1]):null;return e=f,e&&n===null&&l("key"),h[b]={nextPos:d,result:n},n}function B(){var b="inline@"+d,c=h[b];if(c)return d=c.nextPos,c.result;var f=e;e=!1;var g=d;if(a.substr(d,1)==='"'){var i='"';d+=1}else{var i=null;e&&l('"\\""')}if(i!==null){if(a.substr(d,1)==='"'){var j='"';d+=1}else{var j=null;e&&l('"\\""')}if(j!==null)var k=[i,j];else{var k=null;d=g}}else{var k=null;d=g}var m=k!==null?function(){return["literal",""]}():null;if(m!==null)var n=m;else{var o=d;if(a.substr(d,1)==='"'){var p='"';d+=1}else{var p=null;e&&l('"\\""')}if(p!==null){var q=E();if(q!==null){if(a.substr(d,1)==='"'){var r='"';d+=1}else{var r=null;e&&l('"\\""')}if(r!==null)var s=[p,q,r];else{var s=null;d=o}}else{var s=null;d=o}}else{var s=null;d=o}var t=s!==null?function(a){return["literal",a]}(s[1]):null;if(t!==null)var n=t;else{var u=d;if(a.substr(d,1)==='"'){var v='"';d+=1}else{var v=null;e&&l('"\\""')}if(v!==null){var w=C();if(w!==null){var x=[];while(w!==null){x.push(w);var w=C()}}else var x=null;if(x!==null){if(a.substr(d,1)==='"'){var y='"';d+=1}else{var y=null;e&&l('"\\""')}if(y!==null)var z=[v,x,y];else{var z=null;d=u}}else{var z=null;d=u}}else{var z=null;d=u}var A=z!==null?function(a){return["body"].concat(a)}(z[1]):null;if(A!==null)var n=A;else var n=null}}return e=f,e&&n===null&&l("inline"),h[b]={nextPos:d,result:n},n}function C(){var a="inline_part@"+d,b=h[a];if(b)return d=b.nextPos,b.result;var c=x();if(c!==null)var e=c;else{var f=u();if(f!==null)var e=f;else{var g=E(),i=g!==null?function(a){return["buffer",a]}(g):null;if(i!==null)var e=i;else var e=null}}return h[a]={nextPos:d,result:e},e}function D(){var b="buffer@"+d,c=h[b];if(c)return d=c.nextPos,c.result;var f=e;e=!1;var g=d,i=K();if(i!==null){var j=[],k=L();while(k!==null){j.push(k);var k=L()}if(j!==null)var m=[i,j];else{var m=null;d=g}}else{var m=null;d=g}var n=m!==null?function(a,b){return["format",a,b.join("")]}(m[0],m[1]):null;if(n!==null)var o=n;else{var p=d,q=d,r=e;e=!1;var s=H();e=r;if(s===null)var t="";else{var t=null;d=q}if(t!==null){var u=d,v=e;e=!1;var w=K();e=v;if(w===null)var x="";else{var x=null;d=u}if(x!==null){var y=d,z=e;e=!1;var A=G();e=z;if(A===null)var B="";else{var B=null;d=y}if(B!==null){if(a.length>d){var C=a.charAt(d);d++}else{var C=null;e&&l("any character")}if(C!==null)var D=[t,x,B,C];else{var D=null;d=p}}else{var D=null;d=p}}else{var D=null;d=p}}else{var D=null;d=p}var E=D!==null?function(a){return a}(D[3]):null;if(E!==null){var F=[];while(E!==null){F.push(E);var p=d,q=d,r=e;e=!1;var s=H();e=r;if(s===null)var t="";else{var t=null;d=q}if(t!==null){var u=d,v=e;e=!1;var w=K();e=v;if(w===null)var x="";else{var x=null;d=u}if(x!==null){var y=d,z=e;e=!1;var A=G();e=z;if(A===null)var B="";else{var B=null;d=y}if(B!==null){if(a.length>d){var C=a.charAt(d);d++}else{var C=null;e&&l("any character")}if(C!==null)var D=[t,x,B,C];else{var D=null;d=p}}else{var D=null;d=p}}else{var D=null;d=p}}else{var D=null;d=p}var E=D!==null?function(a){return a}(D[3]):null}}else var F=null;var I=F!==null?function(a){return["buffer",a.join("")]}(F):null;if(I!==null)var o=I;else var o=null}return e=f,e&&o===null&&l("buffer"),h[b]={nextPos:d,result:o},o}function E(){var b="literal@"+d,c=h[b];if(c)return d=c.nextPos,c.result;var f=e;e=!1;var g=d,i=d,j=e;e=!1;var k=H();e=j;if(k===null)var m="";else{var m=null;d=i}if(m!==null){var n=d,o=e;e=!1;var p=K();e=o;if(p===null)var q="";else{var q=null;d=n}if(q!==null){var r=F();if(r!==null)var s=r;else{if(a.substr(d).match(/^[^"]/)!==null){var t=a.charAt(d);d++}else{var t=null;e&&l('[^"]')}if(t!==null)var s=t;else var s=null}if(s!==null)var u=[m,q,s];else{var u=null;d=g}}else{var u=null;d=g}}else{var u=null;d=g}var v=u!==null?function(a){return a}(u[2]):null;if(v!==null){var w=[];while(v!==null){w.push(v);var g=d,i=d,j=e;e=!1;var k=H();e=j;if(k===null)var m="";else{var m=null;d=i}if(m!==null){var n=d,o=e;e=!1;var p=K();e=o;if(p===null)var q="";else{var q=null;d=n}if(q!==null){var r=F();if(r!==null)var s=r;else{if(a.substr(d).match(/^[^"]/)!==null){var t=a.charAt(d);d++}else{var t=null;e&&l('[^"]')}if(t!==null)var s=t;else var s=null}if(s!==null)var u=[m,q,s];else{var u=null;d=g}}else{var u=null;d=g}}else{var u=null;d=g}var v=u!==null?function(a){return a}(u[2]):null}}else var w=null;var x=w!==null?function(a){return a.join("")}(w):null;return e=f,e&&x===null&&l("literal"),h[b]={nextPos:d,result:x},x}function F(){var b="esc@"+d,c=h[b];if(c)return d=c.nextPos,c.result;if(a.substr(d,2)==='\\"'){var f='\\"';d+=2}else{var f=null;e&&l('"\\\\\\""')}var g=f!==null?function(){return'"'}():null;return h[b]={nextPos:d,result:g},g}function G(){var b="comment@"+d,c=h[b];if(c)return d=c.nextPos,c.result;var f=e;e=!1;var g=d;if(a.substr(d,2)==="{!"){var i="{!";d+=2}else{var i=null;e&&l('"{!"')}if(i!==null){var j=[],k=d,m=d,n=e;e=!1;if(a.substr(d,2)==="!}"){var o="!}";d+=2}else{var o=null;e&&l('"!}"')}e=n;if(o===null)var p="";else{var p=null;d=m}if(p!==null){if(a.length>d){var q=a.charAt(d);d++}else{var q=null;e&&l("any character")}if(q!==null)var r=[p,q];else{var r=null;d=k}}else{var r=null;d=k}var s=r!==null?function(a){return a}(r[1]):null;while(s!==null){j.push(s);var k=d,m=d,n=e;e=!1;if(a.substr(d,2)==="!}"){var o="!}";d+=2}else{var o=null;e&&l('"!}"')}e=n;if(o===null)var p="";else{var p=null;d=m}if(p!==null){if(a.length>d){var q=a.charAt(d);d++}else{var q=null;e&&l("any character")}if(q!==null)var r=[p,q];else{var r=null;d=k}}else{var r=null;d=k}var s=r!==null?function(a){return a}(r[1]):null}if(j!==null){if(a.substr(d,2)==="!}"){var t="!}";d+=2}else{var t=null;e&&l('"!}"')}if(t!==null)var u=[i,j,t];else{var u=null;d=g}}else{var u=null;d=g}}else{var u=null;d=g}var v=u!==null?function(a){return["comment",a.join("")]}(u[1]):null;return e=f,e&&v===null&&l("comment"),h[b]={nextPos:d,result:v},v}function H(){var b="tag@"+d,c=h[b];if(c)return d=c.nextPos,c.result;var f=d,g=I();if(g!==null){if(a.substr(d).match(/^[#?^><+%:@\/~%]/)!==null){var i=a.charAt(d);d++}else{var i=null;e&&l("[#?^><+%:@\\/~%]")}if(i!==null){var j=d,k=d,m=e;e=!1;var n=J();e=m;if(n===null)var o="";else{var o=null;d=k}if(o!==null){var p=d,q=e;e=!1;var r=K();e=q;if(r===null)var s="";else{var s=null;d=p}if(s!==null){if(a.length>d){var t=a.charAt(d);d++}else{var t=null;e&&l("any character")}if(t!==null)var v=[o,s,t];else{var v=null;d=j}}else{var v=null;d=j}}else{var v=null;d=j}if(v!==null){var w=[];while(v!==null){w.push(v);var j=d,k=d,m=e;e=!1;var n=J();e=m;if(n===null)var o="";else{var o=null;d=k}if(o!==null){var p=d,q=e;e=!1;var r=K();e=q;if(r===null)var s="";else{var s=null;d=p}if(s!==null){if(a.length>d){var t=a.charAt(d);d++}else{var t=null;e&&l("any character")}if(t!==null)var v=[o,s,t];else{var v=null;d=j}}else{var v=null;d=j}}else{var v=null;d=j}}}else var w=null;if(w!==null){var x=J();if(x!==null)var y=[g,i,w,x];else{var y=null;d=f}}else{var y=null;d=f}}else{var y=null;d=f}}else{var y=null;d=f}if(y!==null)var z=y;else{var A=u();if(A!==null)var z=A;else var z=null}return h[b]={nextPos:d,result:z},z}function I(){var b="ld@"+d,c=h[b];if(c)return d=c.nextPos,c.result;if(a.substr(d,1)==="{"){var f="{";d+=1}else{var f=null;e&&l('"{"')}return h[b]={nextPos:d,result:f},f}function J(){var b="rd@"+d,c=h[b];if(c)return d=c.nextPos,c.result;if(a.substr(d,1)==="}"){var f="}";d+=1}else{var f=null;e&&l('"}"')}return h[b]={nextPos:d,result:f},f}function K(){var b="eol@"+d,c=h[b];if(c)return d=c.nextPos,c.result;if(a.substr(d,1)==="\n"){var f="\n";d+=1}else{var f=null;e&&l('"\\n"')}if(f!==null)var g=f;else{if(a.substr(d,2)==="\r\n"){var i="\r\n";d+=2}else{var i=null;e&&l('"\\r\\n"')}if(i!==null)var g=i;else{if(a.substr(d,1)==="\r"){var j="\r";d+=1}else{var j=null;e&&l('"\\r"')}if(j!==null)var g=j;else{if(a.substr(d,1)==="\u2028"){var k="\u2028";d+=1}else{var k=null;e&&l('"\\u2028"')}if(k!==null)var g=k;else{if(a.substr(d,1)==="\u2029"){var m="\u2029";d+=1}else{var m=null;e&&l('"\\u2029"')}if(m!==null)var g=m;else var g=null}}}}return h[b]={nextPos:d,result:g},g}function L(){var b="ws@"+d,c=h[b];if(c)return d=c.nextPos,c.result;if(a.substr(d).match(/^[	 \xA0\uFEFF]/)!==null){var f=a.charAt(d);d++}else{var f=null;e&&l("[\t\f \\xA0\\uFEFF]")}return h[b]={nextPos:d,result:f},f}function M(){function b(a){a.sort();var b=null,c=[];for(var d=0;d<a.length;d++)a[d]!==b&&(c.push(a[d]),b=a[d]);switch(c.length){case 0:return"end of input";case 1:return c[0];default:return c.slice(0,c.length-1).join(", ")+" or "+c[c.length-1]}}var c=b(g),e=Math.max(d,f),h=e<a.length?k(a.charAt(e)):"end of input";return"Expected "+c+" but "+h+" found."}function N(){var b=1,c=1,d=!1;for(var e=0;e<f;e++){var g=a.charAt(e);g==="\n"?(d||b++,c=1,d=!1):g==="\r"|g==="\u2028"||g==="\u2029"?(b++,c=1,d=!0):(c++,d=!1)}return{line:b,column:c}}function O(b,c){return b.text=a.substring(c.split("@")[1],d),b}var c={bodies:t,body:m,buffer:D,comment:G,context:r,end_tag:q,eol:K,esc:F,filters:w,identifier:y,inline:B,inline_part:C,key:A,ld:I,literal:E,params:s,part:n,partial:v,path:z,rd:J,reference:u,sec_tag_start:p,section:o,special:x,tag:H,ws:L};if(b!==undefined){if(c[b]===undefined)throw new Error("Invalid rule name: "+k(b)+".")}else b="body";var d=0,e=!0,f=0,g=[],h={},P=c[b]();if(P===null||d!==a.length){var Q=N();throw new SyntaxError(M(),Q.line,Q.column)}return P},toSource:function(){return this._source}};return a.SyntaxError=function(a,b,c){this.name="SyntaxError",this.message=a,this.line=b,this.column=c},a.SyntaxError.prototype=Error.prototype,a}();return a.parse=b.parse,a})